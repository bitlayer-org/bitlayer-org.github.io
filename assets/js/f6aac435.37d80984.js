"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8604],{9204:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"Build/DeveloperResources/Telegram-Mini-App-Integration","title":"Telegram Mini App Integration","description":"\ud83d\udca1","source":"@site/docs/Build/DeveloperResources/Telegram-Mini-App-Integration.md","sourceDirName":"Build/DeveloperResources","slug":"/Build/DeveloperResources/Telegram-Mini-App-Integration","permalink":"/docs/Build/DeveloperResources/Telegram-Mini-App-Integration","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"buildSidebar","previous":{"title":"DefiLlama TVL Integration","permalink":"/docs/Build/DeveloperResources/Defillama-TVL-integration"},"next":{"title":"Cross-chain Protocols","permalink":"/docs/Build/DeveloperResources/Cross-chain"}}');var r=t(4848),o=t(8453);const l={sidebar_position:8},c="Telegram Mini App Integration",a={},s=[{value:"Step 1: Install the Required Dependencies",id:"step-1-install-the-required-dependencies",level:2},{value:"Step 2: Configure Wallet Connect and Bitlayer Chain Information in wagmiConfig",id:"step-2-configure-wallet-connect-and-bitlayer-chain-information-in-wagmiconfig",level:2},{value:"Step 3: Initialize Wallet Connection in the Dapp (Metamask)",id:"step-3-initialize-wallet-connection-in-the-dapp-metamask",level:2},{value:"Full Example Code",id:"full-example-code",level:2},{value:"Appendix",id:"appendix",level:2}];function d(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"telegram-mini-app-integration",children:"Telegram Mini App Integration"})}),"\n",(0,r.jsxs)("aside",{children:[(0,r.jsx)(e.p,{children:"\ud83d\udca1"}),(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"This guide describes how to install the necessary dependencies, configure wagmi, and initialize the wallet connection, ensuring that the wallet app is successfully invoked in the Telegram Mini App environment for integration with the Bitlayer chain."}),"\n"]})]}),"\n",(0,r.jsx)(e.h2,{id:"step-1-install-the-required-dependencies",children:"Step 1: Install the Required Dependencies"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"npm install @tanstack/react-query @telegram-apps/react-router-integration @telegram-apps/sdk @telegram-apps/sdk-react @telegram-apps/telegram-ui @tonconnect/ui-react eruda react react-dom react-router-dom viem wagmi\n"})}),"\n",(0,r.jsx)(e.h2,{id:"step-2-configure-wallet-connect-and-bitlayer-chain-information-in-wagmiconfig",children:"Step 2: Configure Wallet Connect and Bitlayer Chain Information in wagmiConfig"}),"\n",(0,r.jsx)(e.p,{children:"In this section we will configure Wallet Connect and the Bitlayer mainnet and testnet information through wagmi."}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Get the projectId for your project from ",(0,r.jsx)(e.a,{href:"https://cloud.walletconnect.com/",children:"Wallet Connect Cloud"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:["Import ",(0,r.jsx)(e.code,{children:"btr"})," (Bitlayer mainnet) and ",(0,r.jsx)(e.code,{children:"btrTestnet"})," (Bitlayer testnet) provided by wagmi."]}),"\n",(0,r.jsxs)(e.li,{children:["Use ",(0,r.jsx)(e.code,{children:"createConfig"})," to create the wagmi configuration, including the chain information and Wallet Connect projectId."]}),"\n",(0,r.jsxs)(e.li,{children:["After configuring wagmiConfig, import it into the ",(0,r.jsx)(e.code,{children:"WagmiProvider"}),"."]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:"  <WagmiProvider config={wagmiConfig}>\n    <App />\n  </WagmiProvider>\n"})}),"\n",(0,r.jsx)(e.p,{children:"The code example is as follows:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:'import { http, createConfig } from "wagmi";\nimport { btr, btrTestnet } from "wagmi/chains";\nimport { walletConnect } from "wagmi/connectors";\n\nexport const config = createConfig({\n  chains: [btr, btrTestnet],\n  connectors: [\n    // Get projectId at https://cloud.walletconnect.com\n    walletConnect({\n      projectId: "YOUR_PROJECT_ID",\n    }),\n  ],\n  transports: {\n    [btr.id]: http(),\n    [btrTestnet.id]: http(),\n  },\n});\n\ndeclare module "wagmi" {\n  interface Register {\n    config: typeof config;\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"step-3-initialize-wallet-connection-in-the-dapp-metamask",children:"Step 3: Initialize Wallet Connection in the Dapp (Metamask)"}),"\n",(0,r.jsxs)(e.p,{children:["When initializing the Dapp, we need to address the compatibility issue of Wallet Connect within the Telegram Mini App environment. The key point here is to invoke the wallet through Wallet Connect by overriding ",(0,r.jsx)(e.code,{children:"window.open"})," during the Dapp page initialization."]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["In the ",(0,r.jsx)(e.code,{children:"useEffect"})," hook, the ",(0,r.jsx)(e.code,{children:"window.open"})," method is overridden to handle specific URL schemes, such as ",(0,r.jsx)(e.code,{children:"metamask://"}),", which is the protocol Wallet Connect typically uses to launch wallets."]}),"\n",(0,r.jsxs)(e.li,{children:["Handling specific URLs: In the overridden ",(0,r.jsx)(e.code,{children:"window.open"})," method, when the URL starts with ",(0,r.jsx)(e.code,{children:"metamask://"}),", it is converted to ",(0,r.jsx)(e.code,{children:"https://metamask.app.link/"}),". The reason for this conversion is:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["The native URL scheme ",(0,r.jsx)(e.code,{children:"metamask://"})," cannot be directly used in the Telegram Mini App because it is not correctly recognized by Telegram\u2019s in-app browser."]}),"\n",(0,r.jsx)(e.li,{children:"By converting the protocol to an https://-based URL, it allows the browser to redirect to a compatible web link, which can then trigger the Metamask app."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["Use ",(0,r.jsx)(e.code,{children:"utils.openLink"})," from the Telegram Mini App SDK to open the link: By calling ",(0,r.jsx)(e.code,{children:"utils.openLink(url)"}),", the converted URL can be opened within the Telegram Mini App environment. This ensures that the link is handled correctly by the in-app browser and eventually triggers the wallet app."]}),"\n"]}),"\n",(0,r.jsxs)("aside",{children:[(0,r.jsx)(e.p,{children:"\ud83d\udca1"}),(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"Note: This method relies on the API provided by the Telegram Mini App, so it can only be executed within the Telegram Mini App environment. You should ensure that this method is not executed in other environments."}),"\n"]})]}),"\n",(0,r.jsx)(e.p,{children:"The code example is as follows:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:'  import { initUtils } from \'@telegram-apps/sdk\';\n  \n  const isTelegramEnvironment = async () => {\n  try {\n    if (\n      typeof window !== "undefined" &&\n      window.Telegram &&\n      window.Telegram.WebApp\n    ) {\n      return true;\n    }\n\n    if (\n      "TelegramWebviewProxy" in window &&\n      typeof window.TelegramWebviewProxy.postEvent === "function"\n    ) {\n      window.TelegramGameProxy = { receiveEvent() {} };\n      return true;\n    }\n    return false;\n  } catch (error) {\n    console.error("Error detecting Telegram environment", error);\n    return false;\n  }\n};\n\n  // Override window.open in useEffect\n  useEffect(() => {\n    const init = async () => {\n      const isTG = await isTelegramEnvironment();\n      if (!isTG) {\n        return;\n      }\n      const utils = initUtils(); // Initialize the Telegram SDK utility class\n      window.open = (url) => {\n        console.log(`Try to openLink ${url}`);\n        try {\n          if (!url) {\n            return null;\n          }\n\n          if (typeof url !== "string") {\n            url = url.toString();\n          }\n\n          if (url.startsWith("metamask://")) {\n            url = url.replace("metamask://", "https://metamask.app.link/"); // Replace the MetaMask-specific link with a compatible app link\n          }\n\n          console.log(`Opening ${url}`);\n          utils.openLink(url); // Use Telegram\'s SDK utility to open the link, suitable for the Telegram Mini App environment\n        } catch (error) {\n          console.error(`Failed to openLink ${url}`, error);\n        }\n\n        return null;\n      };\n    };\n    init();\n  }, []);\n'})}),"\n",(0,r.jsx)(e.h1,{id:"step-4-handle-wallet-connection-with-wagmi",children:(0,r.jsx)(e.strong,{children:"Step 4: Handle Wallet Connection with wagmi"})}),"\n",(0,r.jsx)(e.p,{children:"In Step 2 and Step 3, we completed two key steps:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Configured Wallet Connect and Bitlayer chain information in wagmi."}),"\n",(0,r.jsxs)(e.li,{children:["Overrode the ",(0,r.jsx)(e.code,{children:"window.open"})," method during Dapp initialization."]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"After completing these steps, you can handle wallet connections through wagmi, enabling the connection to the Bitlayer chain via Wallet Connect within the Telegram Mini App."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:'import { useAccount, useConnect, useDisconnect } from "wagmi";\nimport { Button, Cell, List, Section, Text } from "@telegram-apps/telegram-ui";\n\nexport function WalletConnectPage() {\n  const { connectors, connect, isLoading: isConnecting } = useConnect();\n  const { disconnect, isLoading: isDisconnecting } = useDisconnect();\n  const { address, chain } = useAccount();\n\n  const handleConnect = async () => {\n    const connector = connectors.find(\n      (connector) => connector.id === "walletConnect"\n    );\n    if (!connector) {\n      console.warn("Connector not found");\n      return;\n    }\n    try {\n      await connect({ connector });\n      console.log("Connected successfully");\n    } catch (error) {\n      console.error("Connection failed", error);\n    }\n  };\n\n  const handleDisconnect = async () => {\n    try {\n      await disconnect();\n      console.log("Disconnected successfully");\n    } catch (error) {\n      console.error("Disconnection failed", error);\n    }\n  };\n\n  return (\n    <List>\n      <Section\n        style={{\n          display: "flex",\n          justifyContent: "center",\n          alignItems: "center",\n          flexDirection: "column",\n          gap: "10px",\n          height: "100vh",\n        }}\n      >\n        <Cell>\n          {!address ? (\n            <Button\n              onClick={handleConnect}\n              disabled={isConnecting}\n              style={{ backgroundColor: "#E36E1B", color: "black" }}\n            >\n              {isConnecting ? "Connecting..." : "Connect to Bitlayer"}\n            </Button>\n          ) : (\n            <div\n              style={{\n                display: "flex",\n                justifyContent: "center",\n                flexDirection: "column",\n                alignItems: "center",\n                gap: "10px",\n              }}\n            >\n              <Text>Connected Address: {address}</Text>\n              <Text>Chain: {chain?.name}</Text>\n              <Button\n                onClick={handleDisconnect}\n                style={{ backgroundColor: "#E36E1B", color: "black" }}\n                disabled={isDisconnecting}\n              >\n                {isDisconnecting ? "Disconnecting..." : "Disconnect"}\n              </Button>\n            </div>\n          )}\n        </Cell>\n      </Section>\n    </List>\n  );\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"full-example-code",children:"Full Example Code"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:'import React, { useEffect, useState } from "react";\nimport ReactDOM from "react-dom/client";\nimport { QueryClient, QueryClientProvider } from "@tanstack/react-query";\nimport { http, createConfig, WagmiProvider } from "wagmi";\nimport { walletConnect } from "wagmi/connectors";\nimport { btr, btrTestnet } from "wagmi/chains";\nimport { initUtils } from "@telegram-apps/sdk";\nimport { AppRoot } from "@telegram-apps/telegram-ui";\nimport { WalletConnectPage } from "./walletPage";\n\nconst isTelegramEnvironment = async () => {\n  try {\n    if (\n      typeof window !== "undefined" &&\n      window.Telegram &&\n      window.Telegram.WebApp\n    ) {\n      return true;\n    }\n\n    if (\n      "TelegramWebviewProxy" in window &&\n      typeof window.TelegramWebviewProxy.postEvent === "function"\n    ) {\n      window.TelegramGameProxy = { receiveEvent() {} };\n      return true;\n    }\n    return false;\n  } catch (error) {\n    console.error("Error detecting Telegram environment", error);\n    return false;\n  }\n};\n\nconst queryClient = new QueryClient();\nconst projectId = "66d607b203a67132234a7b85c0353f61";\n\nconst wagmiConfig = createConfig({\n  chains: [btr, btrTestnet],\n  connectors: [\n    // Get projectId at https://cloud.walletconnect.com\n    walletConnect({\n      projectId: projectId,\n    }),\n  ],\n  transports: {\n    [btr.id]: http(),\n    [btrTestnet.id]: http(),\n  },\n});\n\nconst App = () => {\n  useEffect(() => {\n    const init = async () => {\n      const isTG = await isTelegramEnvironment();\n      if (!isTG) {\n        return;\n      }\n      const utils = initUtils(); // Initialize the Telegram SDK utility class\n      window.open = (url) => {\n        console.log(`Try to openLink ${url}`);\n        try {\n          if (!url) {\n            return null;\n          }\n\n          if (typeof url !== "string") {\n            url = url.toString();\n          }\n\n          if (url.startsWith("metamask://")) {\n            url = url.replace("metamask://", "https://metamask.app.link/"); // Replace the MetaMask-specific link with a compatible app link\n          }\n\n          console.log(`Opening ${url}`);\n          utils.openLink(url); // Use Telegram\'s SDK utility to open the link, suitable for the Telegram Mini App environment\n        } catch (error) {\n          console.error(`Failed to openLink ${url}`, error);\n        }\n\n        return null;\n      };\n    };\n    init();\n  }, []);\n\n  return (\n    <React.StrictMode>\n      <WagmiProvider config={wagmiConfig}>\n        <QueryClientProvider client={queryClient}>\n          <AppRoot>\n            <WalletConnectPage />\n          </AppRoot>\n        </QueryClientProvider>\n      </WagmiProvider>\n    </React.StrictMode>\n  );\n};\n\nReactDOM.createRoot(document.getElementById("root")).render(<App />);\n'})}),"\n",(0,r.jsx)(e.h2,{id:"appendix",children:"Appendix"}),"\n",(0,r.jsxs)("aside",{children:[(0,r.jsx)(e.p,{children:"\ud83d\udca1"}),(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:["Bitlayer provides a more detailed and complete demo project for reference: ",(0,r.jsx)(e.a,{href:"https://github.com/bitlayer-org/tg-mini-app-demo",children:"https://github.com/bitlayer-org/tg-mini-app-demo"})]}),"\n"]})]})]})}function p(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>l,x:()=>c});var i=t(6540);const r={},o=i.createContext(r);function l(n){const e=i.useContext(o);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),i.createElement(o.Provider,{value:e},n.children)}}}]);